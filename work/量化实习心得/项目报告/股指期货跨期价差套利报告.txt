

 



 

股指期货跨期价差套利报告

 

杨睿

摘要：

       跨期套利是通过不同月份合约之间的价差变动来获取收益的一种方式，能有效回避单个期货合约价格剧烈波动的风险，市场比较活跃时，各合约间的价差比较剧烈，可以利用这些机会套利操作赚取低风险甚至无风险收益。本次研究针对中证 500 的当月和次月合约，利用其高频跳价数据，构建了价差判断模型，分析了股指期货跨期套利的可能性。我们对近一个月的 IC1707 、 IC1708 两支合约进行了回测，并在最后指出了策略的优缺点以及可能会存在的问题，给出未来的任务规划。

 

一、     简介

 

股指期货跨期价差套利，建立在股指期货跨期价差存在较大波动的基础上。简单的说，当近月与远月合约价差较大时，我们认为近月合约价格被高估，远月合约价格被低估，因此做空近月合约，做多远月合约，当近月与远月合约价差缩小时，我们可以进行平仓操作，以赚取套利收益。同样，我们可以在近月与远月合约价差较小时做多近月，做空远月，在价差拉大时平仓。

 

我们定义一个多头价差组合为：买入当月合约，卖出次月合约；对应的，一个空头价差组合为：卖出当月合约，买入次月合约。而一次正向的套利交易为多头价差组合开仓 + 空头价差组合平仓，一次反向的套利交易为空头价差组合开仓 + 多头价差组合平仓。由于同一期货合约的买入价与卖出价不一样，需根据对手盘价格进行分析（目前网上的诸多该策略研究均未考虑对手盘价格，导致回测结果非常高，但无法用于实盘），因此多头价差组合与空头价差组合分别对应一条价差序列。以 6 月 19 日到 6 月 26 日 IC1707 和 IC1708 合约为例 [1] ，见图 1 、图 2 ，其中，蓝色线为多头价差组合的价差序列，绿色线为空头价差组合的价差序列，横轴为时间，纵轴为价差。

 

可以看出， 6 月 19 日到 6 月 26 日的价差波动幅度较大，因此套利空间较大。具体的套利步骤为：在多头价差（蓝色线）的相对低点做多价差，在空头价差（绿色线）的相对高点做空价差平仓，完成一次正向套利；在空头价差（绿色线）的相对高点做空价差，在多头价差（蓝色线）的相对低点做多价差平仓，完成一次反向套利。



图 1         6 月 19 日到 6 月 26 日多头价差组合



图 2        6 月 19 日到 6 月 26 日空头价差组合

 

然而实际进行套利操作时，可能会遇到如下问题：

 

l    如何判断何时为多头的低点、何时为空头的高点

l    今日平仓（平今）手续费高昂

l    交易缺腿：收盘时发现之前开的多头或是空头价差仓位未平

l    交易滑点

l    下单后未成交

l    其他

 

针对以上问题，我们在下文分别进行了应对与处理。

 

二、     价差模型构建

 

（1）     简单的均值分位数模型

 

图 1 、图 2 中可以大致看出多头与空头价差时弱平稳的（均值不变，自相关性只和时间间隔有关），因此历史数据的均值和标准差（或者是分位数）可以作为当前或是未来的均值和标准差的无偏估计，我们可以简单的利用以往几日的价差均值和标准差（或者是分位数）来识别当前多头价差的低点和空头价差的高点位置。

同时我们也发现，多头价差的上部、空头价差的下部具有非常多的异常值，且该异常值没法利用（因为在多头价差非常高的地方做多是没有意义的），而这些异常值对我们计算标准差或者是分位数时都会产生较大的影响。我们发现，多头价差的均值以上部分以及空头价差的均值以下部分是没有利用价值的，而正是此部分异常数据非常多，因此我们选择只针对多头均值以下部分计算下分位数（如 5% 分位数），针对空头价差均值以上的部分计算上分位数（如 95% 分位数），用来获取有价值的分位数数据。当然，可替代的方法还有异常值剔除以及 Winsor 异常值替换等方法。

根据 6 月 19 日到 6 月 26 日多空头价差数据，我们利用上述方法，根据不同的分位数计算出多空头阈值，见表 1 ，其中日期对应的数字为当天超过阈值的信号点的数目。由于股指期货每天交易限制为 20 笔，而一次正向或是反向套利需要 4 笔交易，每日交易次数不能使用完，因此我们每天只可以做四次正向或是反向套利，共计 16 笔，需要多头或是空头的信号点至少大于 4 ，加上平仓后，需要大于 8 。

表 1       分位数模型阈值与信号点数

 多空

 分位数

 阈值

 6-19

 6-20

 6-21

 6-22

 6-23

 6-26


 long

 0.05

 38.8

 891

 84

 25

 390

 434

 622


 short

 0.95

 38.59

 718

 149

 444

 169

 385

 700


 long

 0.03

 38

 681

 41

 9

 212

 186

 379


 short

 0.97

 39

 567

 89

 285

 90

 249

 371


 long

 0.02

 37.4

 526

 3

 2

 121

 79

 231


 short

 0.98

 39.39

 443

 46

 165

 33

 136

 192


 long

 0.01

 36.4

 270

 0

 1

 56

 41

 112


 short

 0.99

 40

 284

 18

 79

 8

 59

 68


 

表 1 中发现，当取 3% 和 97% 的分位数组合时，所有日期均满足，但是此时最小收益只有一个点，利润非常小。而当取到 2% 和 98% 的分位数组合时， 6 月 21 号的多头信号只有 2 个， 20 号的多头信号也只有 3 个，当提高到 1% 和 99% 时部分日期的信号已经非常少，因此我们取 2% 和 98% 的分位数组合，为了使结果更加的稳健，我们放宽 0.1 个百分点，取多头价差的阈值为 36.7 ，空头价差的阈值为 39.73 。

该方法的缺点是，倘若价差在一日之内剧烈波动，或是偏离平稳状态，则很可能出现捕捉不到信号点的情况，比如 6 月的 20 号和 21 号，对此我们可以做出相应改进，例如：倘若在上午两小时内尚未平完昨日的仓位，寻找信号点少的是多头还是空头，如果是多头则提高相应的阈值，如果时空头则降低相应的阈值，实现阈值的一个动态的调整。

 

（2）     指数平滑模型

 

为了避免上述分位数模型出现的价差偏离平稳状态的情况，我们选择指数平滑模型进行改进。

当前比较流行的滑动方法有两种，分别为滑动平均法 (Moving Average) 和指数平滑法 (Exponential Moving Average) ，由于滑动平均法将导致样本一定程度的损失，且平滑效果不如指数平滑方法，因此我们采取指数平滑方法进行模拟价差走势，并且计算出拟合残差。通过残差的标准正态分布检验，我们发现残差以非常高的置信水平 (>99.99%) 服从标准正太分布，可以认为指数平滑方法对序列起到了降噪作用，能够反映价差走势。

       那么现在的问题是，该如何确定多头价差的信号下界、空头价差的信号上界。我们首先尝试了根据昨日价差数据的残差的 99% 分位数确定，但是发现和今天样本残差的 99% 分位数差距较大。实际上，由于每天日内的变动情况由当前市场行情以及交易情况决定，日内价差的波动率是高度自相关的，那么可以把开盘前二十分钟，或者更长时间观测到的跳价数据的波动率（标准差）作为今天一整天的波动率的近似估计。因此我们利用开盘前二十分钟价差相对于指数平滑值的残差的 99% 分位数，作为今天整体分位数的近似估计，根据分位数计算出相应的多头下界和空头上界，结果见图 3 （由于这是之前的研究，数据选取的是 6 月 8 日数据）。

 



图 3       滑动平均模型信号边界与信号点

 

       图中红色点为做多价差的信号点，绿色点为做空价差的信号点，红色箭头为一次正向套利，绿色箭头为一次反向套利。可以看出， 6 月 8 日一共按照该算法可以捕捉到 5 次完整的套利机会，分别为三正两负。可以看出该模型较好的捕捉到了多头的低点与空头的高点，并且有着较大的收益。

三、     其他问题

针对平今手续费高昂的问题，我们选择当日锁仓，即根据开仓的方向进行反向开仓，然后隔日平仓。由于股指期货每日开仓限制为 20 手，且不能做满，因此我们选择每日完成 4 笔开仓锁仓操作，每笔需要 4 手合约买入或者卖出操作，共计 16 手每天。由于平仓无限制，因此第二天可以根据信号点进行反向平仓，最多为 16 手（根据上一交易日的开仓情况）。针对当天可能没找到合适机会锁仓的情况，我们在当天 14 点 50 分以后，如果还有仓位未锁，则进行锁仓，以避免隔夜仓出现。总结策略实施步骤如下：

 

l   第一天：

(1)    遇到第一个多头（空头）信号点，开仓买入（卖出）当月，卖出（买入）次月，等待下一个空头（多头）信号点

(2)    下一个空头（多头）信号点出现，开仓卖出（买入）当月，买入（卖出）次月，一次正向（反向）套利完成，记正向（反向）套利一次

(3)    重复 (2)-(3) 直至正向与反向套利次数均达到 2 次，结束

(4)    如果 14:50 分仍有仓未锁，进行锁仓，若正向反向没达到两次，无视跳过。

 

l   第二天及以后：

(1)    遇到第一个多头（空头）信号点，开仓买入（卖出）当月，卖出（买入）次月，等待下一个空头（多头）信号点

(2)    下一个空头（多头）信号点出现，开仓卖出（买入）当月，买入（卖出）次月，一次正向（反向）平仓完成，记正向（反向）平仓一次

(3)    将昨日开的仓全部平完，进行与第一天类似的开仓、锁仓操作。如果没有平完，则留至下一交易日平仓。

 

四、     回测

 

（1）     简单分位数模型回测

 

由于 Wind 上只能取到最近一周的股指期货跳价数据，我们利用 6 月 19 日到 6 月 26 日数据进行回测，多头价差与空头价差阈值选取 36.7 和 39.73 ；保证金比率为 35% ；滑点为每笔交易 0.25 个点，一次多头或是空头组合 0.5 个点，一次正向套利 1 个点；手续费为万 0.23 ，初始资本为一千万。

注意，在回测中平仓时，为了克服有些信号点过少且集中的情况，我们遇到多头信号即买入平仓、遇到空头信号则卖出平仓，而不是像开仓时买 - 卖、卖 - 买交替进行。

回测详细记录见附表 1 。可以看出，在交易机会较少的 20 号， 21 号两天，所有交易机会均用来了平仓，而后 22 号继续开仓，整体的收益曲线如图 4 所示。



图 4        策略一总资产变化

 

通过计算，得到 6 月 26 日时的年化收益率为 7.11% （一年 250 个交易日），相对不考虑滑点时的年化为 9.12% 。事实上，真正的资金占用最高为 6730934.0 元，一千万中有很大一部分资金是闲置的，只需 800 万即可，此时策略年化为 8.88% ，不考虑滑点时为 11.49% 。

 

（2）     滑动平均模型回测

 

我们利用 6 月 19 日到 6 月 26 日数据进行回测，多头价差与空头价差阈值选取 36.7 和 39.73 ；保证金比率为 35% ；滑点为每笔交易 0.25 个点，一次多头或是空头组合 0.5 个点，一次正向套利 1 个点；手续费为万 0.23 ，初始资本为 800 万。

回测详细记录见附表 2 ，在之前的分位数模型中， 6 月 20 和 21 号分别捕捉到了 5 次和 1 次实际信号，均用于平仓。而滑动平均模型在 6 月 20 号捕捉到 8 次信号，实现仓位全平，没有开仓； 6 月 21 号捕捉到 7 次信号，最后接近收盘时强制锁仓。对比下来，滑动平均模型能够更好的适应价差偏离平稳状态的情况。再对比两个模型的收益情况，见图 5 。



图 5        策略一、策略二总资产变化

 

      可以看出，虽然策略二能够捕捉到更多的交易机会，但是策略收益相对不稳定，存在一定的回撤，最终年化收益为 4.87% ，略小于策略一的 8.88% 年化。

 

五、     总结与规划

本次研究中，我们针对股指期货跨期价差的波动特征进行套利可能性分析、策略与模型构建以及回测。首先，我们利用简单的均值分位数模型、滑动平均模型对多头与空头的信号点进行判别，然后我们分析了在实际操作中可能遇到的问题，并且进行相应的改进，最后我们分别对两种策略利用近期一周数据进行回测，并进行对比分析。

股指期货跨期价差套利的原理十分简单，但是在实际操作时会出现很多细节问题。在接下来的研究中，我们会把重点放在如下几个方面：

n   模型改进：考虑到类似 6 月 20 号 21 号的情况，可以将模型改进为阈值动态调整的形式，如果一段时间内平仓或是开仓信号不足，则适当降低阈值，以增加信号数目。

n   模拟盘对接：目前对接 Wind 的期货模拟账户的代码已经写好，但是目前会遇到提交废单的情况，这个问题我会在未来联系万得解决，或者是利用 CTP 接口进行模拟盘操作。对接成功模拟盘后，将利用一到两周进行观察与模型调整。

 

 

附表 1 ：

此附表为简单分位数模型回测详细记录，其中第一列为交易行为记录，第二列为详细时间，第三列为交易时的价差。

 

买入开仓， 2017-06-19 09:30:15.105002 35.0

卖出开仓， 2017-06-19 11:06:36.104998 39.8

卖出开仓， 2017-06-19 11:06:42.605003 39.8

买入开仓， 2017-06-19 13:47:47.605003 35.2

买入开仓， 2017-06-19 13:54:55.104998 36.2

卖出开仓， 2017-06-19 14:14:17.105002 39.8

卖出开仓， 2017-06-19 14:14:23.604996 40.2

断腿开多 , 2017-06-19 14:50:02.105004 40.2

-----------------------------------

总盈利： 1800.0

总手续费： 439.60

保证金： 6689634.0

总资产： 10001360.3955

-----------------------------------

卖出平仓， 2017-06-20 09:45:33.704998 40.0

卖出平仓， 2017-06-20 09:45:34.204996 40.0

卖出平仓， 2017-06-20 09:45:34.705003 40.0

卖出平仓， 2017-06-20 09:45:35.205000 40.0

买入平仓， 2017-06-20 10:06:50.205005 36.6

买入平仓， 2017-06-21 10:48:40.604997 36.4

买入平仓， 2017-06-22 09:32:47.405001 35.8

买入平仓， 2017-06-22 09:32:49.405000 36.4

-----------------------------------

买入开仓， 2017-06-22 09:32:51.404999 36.0

卖出开仓， 2017-06-22 09:57:21.904999 40.2

买入开仓， 2017-06-22 09:59:19.905003 34.0

卖出开仓， 2017-06-22 10:00:02.905001 39.8

卖出开仓， 2017-06-22 10:17:04.405003 39.8

买入开仓， 2017-06-22 13:06:31.404996 32.4

卖出开仓， 2017-06-22 13:29:06.904997 40.0

买入开仓， 2017-06-22 14:43:43.905004 36.4

-----------------------------------

总盈利： 7360.0

总手续费： 1324.45

保证金： 6730934.0

总资产： 10006035.5441

-----------------------------------

买入平仓， 2017-06-23 09:31:44.804998 34.8

买入平仓， 2017-06-23 09:32:02.305004 36.2

买入平仓， 2017-06-23 09:32:26.805002 35.6

买入平仓， 2017-06-23 09:32:27.304999 34.6

卖出平仓， 2017-06-23 09:40:57.804996 48.2

卖出平仓， 2017-06-23 09:48:09.804997 41.0

卖出平仓， 2017-06-23 09:55:01.304998 39.8

卖出平仓， 2017-06-23 11:27:22.304997 40.2

-----------------------------------

买入开仓， 2017-06-23 13:00:17.805001 36.6

卖出开仓， 2017-06-23 13:09:02.305003 42.2

卖出开仓， 2017-06-23 13:11:39.304996 39.8

买入开仓， 2017-06-23 13:13:37.305000 36.6

卖出开仓， 2017-06-23 13:20:34.804998 40.2

买入开仓， 2017-06-23 13:47:55.305002 36.6

-----------------------------------

总盈利： 14040.0

总手续费： 2084.074

保证金： 4918088.0

总资产： 10011955.9258

-----------------------------------

卖出平仓， 2017-06-26 09:30:01.304997 42.0

卖出平仓， 2017-06-26 09:30:43.305000 43.4

卖出平仓， 2017-06-26 09:31:00.304998 40.8

买入平仓， 2017-06-26 09:54:55.305000 34.4

买入平仓， 2017-06-26 09:54:56.305005 34.0

买入平仓， 2017-06-26 09:56:11.305000 36.4

-----------------------------------

买入开仓， 2017-06-26 10:01:12.304997 35.6

卖出开仓， 2017-06-26 10:40:39.805000 39.8

卖出开仓， 2017-06-26 11:00:41.305001 40.2

买入开仓， 2017-06-26 14:33:35.304996 36.0

卖出开仓， 2017-06-26 14:37:46.305002 40.0

买入开仓， 2017-06-26 14:46:13.304998 35.0

-----------------------------------

总盈利： 19800.0

总手续费： 2746.8072

保证金： 5070142.0

总资产： 10017053.1928

-----------------------------------

 

 

附表 2 ：

此附表为滑动平均模型回测详细记录，其中第一列为交易行为记录，第二列为详细时间，第三列为交易时的价差。

 

买入开仓， 2017-06-19 09:32:18.104999 40.4

卖出开仓， 2017-06-19 09:32:38.604998 38.8

卖出开仓， 2017-06-19 09:32:40.604997 38.8

买入开仓， 2017-06-19 09:34:00.104999 38.2

买入开仓， 2017-06-19 09:34:00.604996 38.2

卖出开仓， 2017-06-19 09:39:48.105002 36.6

卖出开仓， 2017-06-19 09:39:48.604999 37.6

买入开仓， 2017-06-19 09:47:28.105002 35.2

-----------------------------------

总盈利： -39.9999999998

总手续费： 438.596199999

保证金： 6674290.0

总资本： 9999521.4038

-----------------------------------

买入平仓， 2017-06-20 10:05:34.705002 37.2

买入平仓， 2017-06-20 10:05:35.204999 37.2

买入平仓， 2017-06-20 10:05:35.704997 37.2

买入平仓， 2017-06-20 10:06:50.205005 36.6

卖出平仓， 2017-06-20 13:33:06.204996 40.0

卖出平仓， 2017-06-20 13:53:06.205005 40.2

卖出平仓， 2017-06-20 13:53:06.705002 40.2

卖出平仓， 2017-06-20 14:34:52.704998 41.4

-----------------------------------

-----------------------------------

总盈利： 2680.0

总手续费： 881.489719996

保证金： 0

总资本： 10001798.5103

-----------------------------------

-----------------------------------

卖出开仓， 2017-06-21 09:32:08.105003 42.4

买入开仓， 2017-06-21 09:47:09.605001 39.0

买入开仓， 2017-06-21 09:47:48.605001 38.8

卖出开仓， 2017-06-21 10:06:09.605004 41.8

买入开仓， 2017-06-21 10:47:32.104997 37.8

卖出开仓， 2017-06-21 13:22:54.104997 39.8

卖出开仓， 2017-06-21 13:22:59.604997 39.6

断腿开多 , 2017-06-21 14:50:00.104995 44.6

-----------------------------------

总盈利： 3360.0

总手续费： 1322.1596

保证金： 6705846.0

总资本： 10002037.8404

-----------------------------------

买入平仓， 2017-06-22 09:30:58.904996 42.2

买入平仓， 2017-06-22 09:32:47.405001 35.8

买入平仓， 2017-06-22 09:32:49.405000 36.4

买入平仓， 2017-06-22 09:32:51.404999 36.0

卖出平仓， 2017-06-22 09:49:46.404996 38.2

卖出平仓， 2017-06-22 09:50:21.905004 38.2

卖出平仓， 2017-06-22 09:50:50.904998 38.8

卖出平仓， 2017-06-22 09:50:51.404995 38.8

-----------------------------------

卖出开仓， 2017-06-22 09:50:53.905002 39.0

买入开仓， 2017-06-22 09:59:19.905003 34.0

卖出开仓， 2017-06-22 10:00:02.405004 39.2

买入开仓， 2017-06-22 10:08:29.904997 36.6

买入开仓， 2017-06-22 10:08:32.405004 35.0

卖出开仓， 2017-06-22 10:17:04.405003 39.8

买入开仓， 2017-06-22 13:06:31.404996 32.4

断腿开空 , 2017-06-22 14:50:01.404998 34.0

-----------------------------------

总盈利： 6880.0

总手续费： 2207.23272

保证金： 6732628.0

总资本： 10004672.7673

-----------------------------------

买入平仓， 2017-06-23 09:31:44.804998 34.8

买入平仓， 2017-06-23 09:32:27.304999 34.6

卖出平仓， 2017-06-23 09:34:37.804995 38.4

卖出平仓， 2017-06-23 09:40:57.804996 48.2

卖出平仓， 2017-06-23 09:48:09.804997 41.0

买入平仓， 2017-06-23 13:00:21.305002 31.2

买入平仓， 2017-06-23 13:00:29.804996 34.2

卖出平仓， 2017-06-23 13:09:02.305003 42.2

-----------------------------------

卖出开仓， 2017-06-23 13:11:54.305005 41.2

断腿开多 , 2017-06-23 14:50:00.305004 45.6

-----------------------------------

总盈利： 13000.0

总手续费： 2750.28572

保证金： 1649396.0

总资本： 10010249.7143

-----------------------------------

卖出平仓， 2017-06-26 09:30:43.305000 43.4

买入平仓， 2017-06-26 09:30:43.804997 43.2

-----------------------------------

买入开仓， 2017-06-26 09:38:24.805001 38.4

卖出开仓， 2017-06-26 10:40:07.305005 38.8

卖出开仓， 2017-06-26 10:40:28.804999 39.4

买入开仓， 2017-06-26 14:33:35.304996 36.0

买入开仓， 2017-06-26 14:46:13.304998 35.0

断腿开空 , 2017-06-26 14:50:01.304999 28.8

-----------------------------------

总盈利： 12560.0

总手续费： 3192.75144

保证金： 5065732.0

总资本： 10009367.2486

-----------------------------------




[1] 数据来自 Wind 提供的 python 接口，类型为日内跳价数据